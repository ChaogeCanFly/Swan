classdef Postprocess < handle
       
    properties (Access = protected)                  
        outFileName
        
        resultPrinter
        meshPrinter
        
        mshDataBase
        resDataBase        
    end
    
    
     methods (Access = public)
 
        function obj = Postprocess(postCase,d)            
            obj.init(d);          
            obj.createOutputDirectory();
            obj.createMeshPrinter();
            obj.createResultPrinter(postCase);
        end
               
        function  print(obj,iter,results)
            obj.printMeshFile(iter);            
            obj.printResFile(iter,results)
        end
        
        function r = getResFile(obj)
            r = obj.resultPrinter.getFieldName();
        end
        
        function setIter(obj,i)
            obj.resultPrinter.setIter(i);
        end
        
    end
       
    methods (Access = private)
        
        function init(obj,d)
            obj.outFileName = d.outFileName;            
            obj.computeDataBaseForMeshFile(d);                       
            obj.computeDataBaseForResFile(d); 
        end
        
        function createMeshPrinter(obj)
            obj.meshPrinter = MeshPrinter();            
        end
        
        function createResultPrinter(obj,postCase)
            obj.resultPrinter  = ResultsPrinter.create(postCase,obj.resDataBase);
        end
        
        function printResFile(obj,iter,results)           
            obj.resultPrinter.print(iter,results);            
        end
        
       	function printMeshFile(obj,iter)
            d = obj.mshDataBase;
            d.iter = iter;
            obj.meshPrinter.print(d);
        end
        
        function createOutputDirectory(obj)
            path = pwd;
            %dir = fullfile(path,'Output',obj.outFileName);
            dir = fullfile(path,obj.outFileName);            
            if ~exist(dir,'dir')
                mkdir(dir)
            end            
        end
    end
    
     methods (Access = private)
        
        function computeDataBaseForResFile(obj,dI)
            obj.resDataBase.dStandard = dI;
            obj.createGaussDataBaseForResFile(dI);
        end       
        
        function computeDataBaseForMeshFile(obj,dI)
            d.coordinates    = dI.coordinates;
            d.connectivities = dI.connectivities;
            d.outFileName    = dI.outFileName;
            d.npnod          = dI.npnod;
            d.pdim           = dI.pdim;
            d.nnode          = dI.nnode;
            d.nelem          = dI.nelem;
            d.ndim           = dI.ndim;
            d.etype          = dI.etype;
            obj.mshDataBase = d;
        end
 
     end
    
     methods (Access = private)
         
         
         function postProce
             
             
         end
         
         function createGaussDataBaseForResFile(obj,dI)
             if dI.hasGaussData
                 dG.ngaus = dI.ngaus;
                 dG.posgp = dI.posgp;
                 dG.gaussDescriptor = 'Guass up?';
                 obj.resDataBase.dGauss = dG;
             end
         end
         
     end

end
